.TH Q330_OPT_PKT_MON 1
.SH NAME
q330_opt_pkt_mon \- converts /pf/st packet opt string data to binary values in /pf/vtw packets
.SH SYNOPSIS
.nf
\fBq330_opt_pkt_mon \fP [-v] [-V] [-d] [-0] [-w]
                  [-p \fIpf\fP] [-n \fInpkts\fP]
                  \fIstatus_orb\fP
.fi
.SH DESCRIPTION
\fBq330_opt_pkt_mon\fP is designed to take /pf/st packets generated by q3302orb and
converts the opt data from
.nf

        opt     acok isp1 ti

.fi

to
.nf

        acok    1
        api     0
        ins1    1
        ins2    0
        ti      1

.fi

and puts these /pf/vtw packets back into the orb.
A second mode of running will be using the \fB-w\fP flag. This will  create MGENC
packets of data from each of the values. Each value in the opt string will create a new
seed channel without loc codes. The multiplexed packets will be push to the same orb
as the /pf/st packets. There is an internal buffer for the values that can be modified
in the parameter file. The calib is set to 1 and the segtype to \fBc\fP "dimensionless integer".
The new packets with waveforms will have a name of STA_CHAN_/MGENC/MSTV.


.SH OPTIONS
.IP -v
Verbose
.IP -V
Extremely verbose.  Used for debugging purposes only.
.IP "-n npkts"
Number of packets to process.
.IP -d
Dry run. Don't put any packets back in the orb.
.IP -w
Build MGENC/MSTV data packets and put them back in the orb. Avoid /pf/vtw packets.
.IP "-p parameter_file"
Name of parameter file to use.  $PFPATH is searched to find parameter file.
The default parameter file is \fBq330_opt_pkt_mon\fP.
.IP -0
Start processing oldest packet in orb.

.SH ENVIRONMENT
Needs to have sourced $ANTELOPE/setup.csh.  
.SH PARAMETER FILE
.IP buffer_time_window
Save data in memory for this time before creating a new packet.  Default is 600. 
.IP select_packets
Select orb packets.  Default is ".*/pf/st"
.IP reject_packets
Reject orb packets.  Default is ""
.SH EXAMPLE PARAMETER FILE
.in 2c
.ft CW
.nf

select_packets          .*/pf/st

buffer_time_window      600

reject_packets

.fi
.ft R
.in
.SH RETURN VALUES
0 if successful, 1 if not.
.SH "BUGS AND CAVEATS"
If a gap is detected of more than 1.5 times the samplerate then the buffer is dump for that 
channel and it will start buffering from that point forward.
.HP
Example of the waveform packet that will be produced:
#21 'TA_O20A_/MGENC/MSTV':  3/25/2014 (084) 20:55:17.964 : 484 bytes
     0 : TA       O20A     ACOK               0.017/s calib=           1 calper= 1.000 segtype=c 4 samps Tue 2014-084 Mar 25 20:52:17.73499 - 20:56:17.73498
            1        1        1        1
     1 : TA       O20A     API                0.017/s calib=           1 calper= 1.000 segtype=c 4 samps Tue 2014-084 Mar 25 20:52:17.73499 - 20:56:17.73498
            0        0        0        0
     2 : TA       O20A     INS1               0.017/s calib=           1 calper= 1.000 segtype=c 4 samps Tue 2014-084 Mar 25 20:52:17.73499 - 20:56:17.73498
            0        0        0        0
     3 : TA       O20A     INS2               0.017/s calib=           1 calper= 1.000 segtype=c 4 samps Tue 2014-084 Mar 25 20:52:17.73499 - 20:56:17.73498
            0        0        0        0
     4 : TA       O20A     TI                 0.017/s calib=           1 calper= 1.000 segtype=c 4 samps Tue 2014-084 Mar 25 20:52:17.73499 - 20:56:17.73498
            1        1        1        1


.LP
.SH UPDATE (-w option added)
Juan Reyes <reyes@ucsd.edu>
.SH AUTHOR
Frank Vernon
